<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Laporan PB KJL ZON 3</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
/* Buang blink, tiada perubahan lain */
</style>
</head>
<body class="min-h-screen relative text-sm font-sans">

<!-- Gradient background -->
<div class="absolute inset-0 bg-gradient-to-br from-black via-gray-900 to-gray-800 pointer-events-none"></div>

<div class="relative max-w-3xl mx-auto p-4 space-y-4">

  <!-- Banner -->
  <nav class="h-24 rounded-xl bg-cover bg-center shadow-lg border border-white/20"
       style="background-image:url('DSC_0085_1.jpg')"></nav>

  <!-- Header -->
  <div class="text-center text-white space-y-1">
    <h2 class="text-xl font-bold">ğŸ¤£ by PPB NAZMI ğŸ‘®ğŸ¿â€â™‚ï¸</h2>
    <p class="text-xs italic">
      â†’ Pilih stesen â†’ pilih anggota â†’ Copy & WhatsApp
    </p>
  </div>

  <!-- Card -->
  <div class="bg-white/70 backdrop-blur-md rounded-xl p-4 space-y-3 shadow-xl">

    <!-- Stesen -->
    <div>
      <label class="font-semibold">Stesen Hari Ini</label>
      <select id="stesenSelect" class="w-full p-2 rounded text-sm"></select>
    </div>

    <!-- Anggota Bertugas 3 dropdown -->
    <div>
      <label class="font-semibold">Anggota Bertugas</label>
      <div class="grid grid-cols-3 gap-2 mt-1">
        <select class="anggota w-full p-2 rounded"></select>
        <select class="anggota w-full p-2 rounded"></select>
        <select class="anggota w-full p-2 rounded"></select>
      </div>
    </div>

    <!-- Tambah Stesen -->
    <div class="flex gap-2">
      <input id="newStesen" placeholder="Tambah stesen" class="flex-1 p-2 rounded">
      <button id="addStesen" class="px-3 bg-blue-600 text-white rounded hover:bg-blue-700 transition">Tambah</button>
    </div>

    <!-- Reset -->
    <button id="resetStorage" class="w-full bg-red-500 text-white p-2 rounded hover:bg-red-600 transition">
      Reset Senarai Stesen
    </button>

    <!-- Copy & WhatsApp -->
    <button id="sendReport" class="w-full bg-green-600 text-white p-3 rounded font-semibold hover:bg-green-700 transition">
      Copy & Buka WhatsApp
    </button>

  </div>
</div>

<script>
// DATA
const defaultStesen = ["ABDULLAH HUKUM","KERINCHI","UNIVERSITI","TAMAN JAYA","ASIA JAYA","TAMAN PARAMOUNT","TAMAN BAHAGIA","KELANA JAYA"];
const defaultAnggota = ["PB NAZMI","PPB AHMAD TARMIZI","PB MUHAMMAD ALIF","PB SAINOL ARIFFIN","PPB ILLIYAS","PB ADEHA","PPB AFIFAH","PB ZUHAIRAH","PPB NUR SYAFIKAH NADIA","PB SOLEH","PB HAZIQ","PB NUR SYAHIRA","PB SYASYA"];

const stesenSelect = document.getElementById("stesenSelect");
const anggotaSelects = document.querySelectorAll(".anggota");
const newStesen = document.getElementById("newStesen");
const addStesen = document.getElementById("addStesen");
const resetStorage = document.getElementById("resetStorage");
const sendReport = document.getElementById("sendReport");

let stesenList = JSON.parse(localStorage.getItem("stesenList")) || [...defaultStesen];
let savedAnggota = JSON.parse(localStorage.getItem("anggotaHariIni")) || [];

// LOAD DROPDOWN
function loadDropdown() {
  stesenSelect.innerHTML = "";
  stesenList.forEach(s => stesenSelect.innerHTML += `<option>${s}</option>`);

  anggotaSelects.forEach((sel,i)=>{
    sel.innerHTML = "<option value=''>-</option>";
    defaultAnggota.forEach(a => sel.innerHTML += `<option>${a}</option>`);
    if(savedAnggota[i]) sel.value = savedAnggota[i];
  });
}
loadDropdown();

// SAVE ANGGOTA
anggotaSelects.forEach(sel=>{
  sel.addEventListener("change", ()=>{
    const values = [...anggotaSelects].map(s=>s.value).filter(Boolean);
    localStorage.setItem("anggotaHariIni", JSON.stringify(values));
  });
});

// ADD STESEN
addStesen.addEventListener("click", () => {
  const v = newStesen.value.trim();
  if(v && !stesenList.includes(v)){
    stesenList.push(v);
    localStorage.setItem("stesenList", JSON.stringify(stesenList));
    loadDropdown();
    newStesen.value="";
  }
});

// RESET
resetStorage.addEventListener("click", () => {
  localStorage.clear();
  location.reload();
});

// GENERATE TEKS
function generateText() {
  const now = new Date();
  const tarikh = now.toLocaleDateString("ms-MY");
  const masa = now.toTimeString().slice(0,5).replace(":","")+" HRS";
  const stesen = stesenSelect.value;
  const anggota = [...anggotaSelects].map(s=>s.value).filter(Boolean).join("\n");

  return `*Assalamualaikum wbt & Salam Sejahtera YDH Datuk/Tuan/Puan,*

Laporan penugasan anggota bertugas Aliran Kelana Jaya Jabatan Sekuriti.

TARIKH : ${tarikh}
MASA : ${masa}
TUGASAN : KAWALAN DAN PEMANTAUAN DI PLATFORM 1,2
LOKASI : STESEN ${stesen} (KJL).

1. Lapor kawalan dan pemantauan di platform Stesen ${stesen} (KJL).
2. Pergerakan penumpang keluar/masuk tren lancar.
3. Perkhidmatan tren beroperasi seperti biasa.

Anggota Bertugas:- 
${anggota}

*#TERUSKAN PERKARA BAIK*`;
}

// COPY & WHATSAPP
sendReport.addEventListener("click", () => {
  const text = generateText();
  navigator.clipboard.writeText(text);
  window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`, "_blank");
});
</script>
</body>
</html>